---
layout: $/layouts/post.astro
title: Avril 2023
description: Monthly Avril 2023
tags: 
  - monthly
  - delicorner
date: 2023-04-01
---

# Month

- Int√©gration
- Dockerisation des projets
- R√©initialisation du mot de passe
- Serveur de preprod

# Weeks

## Semaine 14

- Int√©gration
- Dockerisation des projets
  - API - Nodejs
  - Front - Vuejs

## Semaine 15

- R√©initialisation du mot de passe
  - Front
  - API
  - Plateforme
- Pr√©sentation des outils
- Serveur de preprod
- Planning poker

## Semaine 16

- D√©ploiement preprod (API et front)
- Probl√®me de l'assignation automatique des livraisons
- Fix r√©initialisation du mot de passe

## Semaine 17

- Cong√©s

# Days

## Lundi 03

- Rencontre des √©quipes sur Paris.
- Visite des locaux
- R√©cup√©ration du mat√©riel
- Pr√©sentation des outils et des m√©thodes de travail
- Pr√©sentation des projets
- Installation du projet `plateforme`

## Mardi 04

- Finalisation de l'installation du PC
  - Programmes
  - Personnalisation
  - Changement d'username
- `PF-109: Docker - Cr√©er un Docker API`
  - D√©marrage du projet
  - L'API se lance et r√©pond
  - L'IP du container est bien pingable depuis le container `pf-php`
  - Erreur de connexion √† la DB

## Mercredi 05 et Jeudi 06

- `PF-109: Docker - Cr√©er un Docker API`
  - Probl√®me de connexion √† la DB r√©gl√©
    - Probl√®me de port
  - Interconnexion des containers
    - `pf-php` peut ping `api`
    - `api` peut ping `pf-php`

> **Ce qui m'a pos√© probl√®me:**
> Le test depuis l'appli `plateforme` lan√ßait une requ√™te sur la route `/deliveryImages` de l'API.
> Cet appel me d√©clenchait une erreur **ECONNREFUSED**.
> J'ai donc pass√© pas mal de temps √† essayer de trouver d'o√π venait le probl√®me.
> Mais finalement, apr√®s avoir test√© d'autres appels (`/categories`), je me suis rendu compte que la route `/deliveryImages` faisait elle-m√™me appel √† l'API de **MyTroopers**.

  - L'API est bien accessible depuis l'app `plateforme`
  - MR cr√©√©e pour `PF-109`
  - R√©installation du projet `plateforme` ‚Üí cause probl√®me de Git
    - _error updating changes detected dubious ownership_

## Vendredi 07

- `PF-119: Docker - Cr√©er le docker du Front`
  - Front =
    - appli utilis√©e par les clients
    - d√©velopp√©e en Vuejs
  - D√©marrage du projet
  - Installation en local
  - Dockerize
    - Cr√©ation du Dockerfile
    - Cr√©ation du docker-compose
    - Lancement du container
    - L'appli se lance et r√©pond

---

## Mardi 11

- `PF-159: Front Client - R√©initialisation autonome du MDP`
- Weekly

## Mercredi 12

- `PF-159: Front Client - R√©initialisation autonome du MDP`
- R√©union avec Alexis pour la pr√©sentation des projets
- `PF-160: PF - R√©initialisation autonome du MDP`
- Ajout de Xdebug au container `pf-php`

## Jeudi 13

- `PF-160: PF - R√©initialisation autonome du MDP`
  - La feature existe d√©j√†
  - Non fonctionnelle √† cause de l'activityBundle
    - Il cherche l'`id` et l'`username` de l'utilisateur qui fait l'action dans le token
    - Mais l'user n'√©tant pas encore connect√©, l'user est _anonymous_.
    - Donc pas d'`id` et pas d'`username` (voir extrait de code ci-dessous)
  - Sur la page de r√©initialisation, on n'a qu'un champ _mot de passe_
  - Ajout d'un second champ _confirmation du mot de passe_ 
  
~~~php
$id = $token instanceof TokenInterface ? $token->getUser()->getId() : 0;
$username = $token instanceof TokenInterface ? $token->getUser()->getUsername() : 'cron';
~~~

- Reproduire le m√™me comportement que le front => utilisation de l'API pour l'envoi du mail et la r√©initialisation du mot de passe

## Vendredi 14

- Modifications suite aux diff√©rentes code reviews 
  - good practices
  - code style
  - suppression des fichiers `.env`
- Prise en main du serveur **preprod**
- Planning poker

---

## Lundi 17

- Check in

### D√©ployer les projets `front` et `api` sur le serveur **preprod**

- **api** : d√©ploiement de la branche en preprod avec Fr√©d√©rick
  - `git clone xxx api`
  - `cd api`
  - `git fetch origin`
  - `git checkout PF-109`
  - copie du fichier `.env` √† la racine du projet
  - copie du fichier `env.js` dans le dossier `src`
  - `docker compose build`
  - `docker compose up -d`
  - L'api est accessible sur le port 8082 üòÄ

√Ä revoir : 
  - ajouter l'installation de `cross-env` dans le Dockerfile

- **front** : d√©ploiement de la branche en preprod
  - `git clone xxx front`
  - `cd front`
  - `git fetch origin`
  - `git checkout PF-119`
  - copie du fichier `.env` √† la racine du projet
  - `docker compose build`
  - `docker compose up -d`
  - Le front est accessible sur le port 8083 üòÄ

√Ä revoir :
    - probl√®me avec les node_modules

> Penser √† ajouter la conf `volumes` dans le `docker-compose.yml` pour persister les donn√©es

> Ajouter les variables d'environnement dans le `.env` du projet puis dans le Dockerfile
 
## Mardi 18

- d√©ploiement de l'API en preprod
- d√©ploiement du front en preprod
- probl√®me de r√©initialisation de mot de passe: possible seulement pour les ROLE_USER...

## Mercredi 19

- PF-188: Livraison - assignation
  - l'assignation automatique ne fonctionne pas

## Jeudi 20

- PF-188: Livraison - assignation
  - optimisation de l'action gr√¢ce √† cet article -> https://ourcodeworld.com/articles/read/2/5-simple-tips-for-boost-the-database-handling-with-symfony2-and-doctrine (en particulier le point 4)
- Remplissage des fichiers Checkin et Dream
- PF-159 et PF-160 Reset password
  - Fix pour retirer le contr√¥le sur le ROLE_USER pour la plateforme
  - Ouverture de service

~~~sql
CREATE TABLE `reset_password_token` (
  `id` int(11) NOT NULL,
  `user_id` int(11) DEFAULT NULL,
  `token` text,
  `validity` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
ALTER TABLE `reset_password_token`
  ADD PRIMARY KEY (`id`),
  ADD KEY `user_id` (`user_id`) USING BTREE;
ALTER TABLE `reset_password_token`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=120;
~~~

## Vendredi 21

- PF-159 et PF-160 Reset password
  - Retrait de la v√©rification du role dans l'API
- PF-188 : assignation automatique
  - Fix et optimisation de l'assignation automatique par semaine