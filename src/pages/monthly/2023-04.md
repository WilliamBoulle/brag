---
layout: $/layouts/post.astro
title: Avril 2023
description: Monthly Avril 2023
tags: 
  - monthly
  - delicorner
date: 2023-04-01
---

# Month

- IntÃ©gration
- Dockerisation des projets
- RÃ©initialisation du mot de passe
- Serveur de preprod

# Weeks

## Semaine 14

- IntÃ©gration
- Dockerisation des projets
  - API - Nodejs
  - Front - Vuejs

## Semaine 15

- RÃ©initialisation du mot de passe
  - Front
  - API
  - Plateforme
- PrÃ©sentation des outils
- Serveur de preprod
- Planning poker

# Days

## Lundi 03

- Rencontre des Ã©quipes sur Paris.
- Visite des locaux
- RÃ©cupÃ©ration du matÃ©riel
- PrÃ©sentation des outils et des mÃ©thodes de travail
- PrÃ©sentation des projets
- Installation du projet `plateforme`

## Mardi 04

- Finalisation de l'installation du PC
  - Programmes
  - Personnalisation
  - Changement d'username
- `PF-109: Docker - CrÃ©er un Docker API`
  - DÃ©marrage du projet
  - L'API se lance et rÃ©pond
  - L'IP du container est bien pingable depuis le container `pf-php`
  - Erreur de connexion Ã  la DB

## Mercredi 05 et Jeudi 06

- `PF-109: Docker - CrÃ©er un Docker API`
  - ProblÃ¨me de connexion Ã  la DB rÃ©glÃ©
    - ProblÃ¨me de port
  - Interconnexion des containers
    - `pf-php` peut ping `api`
    - `api` peut ping `pf-php`

> **Ce qui m'a posÃ© problÃ¨me:**
> Le test depuis l'appli `plateforme` lanÃ§ait une requÃªte sur la route `/deliveryImages` de l'API.
> Cet appel me dÃ©clenchait une erreur **ECONNREFUSED**.
> J'ai donc passÃ© pas mal de temps Ã  essayer de trouver d'oÃ¹ venait le problÃ¨me.
> Mais finalement, aprÃ¨s avoir testÃ© d'autres appels (`/categories`), je me suis rendu compte que la route `/deliveryImages` faisait elle-mÃªme appel Ã  l'API de **MyTroopers**.

  - L'API est bien accessible depuis l'app `plateforme`
  - MR crÃ©Ã©e pour `PF-109`
  - RÃ©installation du projet `plateforme` â†’ cause problÃ¨me de Git
    - _error updating changes detected dubious ownership_

## Vendredi 07

- `PF-119: Docker - CrÃ©er le docker du Front`
  - Front =
    - appli utilisÃ©e par les clients
    - dÃ©veloppÃ©e en Vuejs
  - DÃ©marrage du projet
  - Installation en local
  - Dockerize
    - CrÃ©ation du Dockerfile
    - CrÃ©ation du docker-compose
    - Lancement du container
    - L'appli se lance et rÃ©pond

---

## Mardi 11

- `PF-159: Front Client - RÃ©initialisation autonome du MDP`
- Weekly

## Mercredi 12

- `PF-159: Front Client - RÃ©initialisation autonome du MDP`
- RÃ©union avec Alexis pour la prÃ©sentation des projets
- `PF-160: PF - RÃ©initialisation autonome du MDP`
- Ajout de Xdebug au container `pf-php`

## Jeudi 13

- `PF-160: PF - RÃ©initialisation autonome du MDP`
  - La feature existe dÃ©jÃ 
  - Non fonctionnelle Ã  cause de l'activityBundle
    - Il cherche l'`id` et l'`username` de l'utilisateur qui fait l'action dans le token
    - Mais l'user n'Ã©tant pas encore connectÃ©, l'user est _anonymous_.
    - Donc pas d'`id` et pas d'`username` (voir extrait de code ci-dessous)
  - Sur la page de rÃ©initialisation, on n'a qu'un champ _mot de passe_
  - Ajout d'un second champ _confirmation du mot de passe_ 
  
~~~php
$id = $token instanceof TokenInterface ? $token->getUser()->getId() : 0;
$username = $token instanceof TokenInterface ? $token->getUser()->getUsername() : 'cron';
~~~

- Reproduire le mÃªme comportement que le front => utilisation de l'API pour l'envoi du mail et la rÃ©initialisation du mot de passe

## Vendredi 14

- Modifications suite aux diffÃ©rentes code reviews 
  - good practices
  - code style
  - suppression des fichiers `.env`
- Prise en main du serveur **preprod**
- Planning poker

---

## Lundi 17

- Check in

### DÃ©ployer les projets `front` et `api` sur le serveur **preprod**

- **api** : dÃ©ploiement de la branche en preprod avec FrÃ©dÃ©rick
  - `git clone xxx api`
  - `cd api`
  - `git fetch origin`
  - `git checkout PF-109`
  - copie du fichier `.env` Ã  la racine du projet
  - copie du fichier `env.js` dans le dossier `src`
  - `docker compose build`
  - `docker compose up -d`
  - L'api est accessible sur le port 8082 ðŸ˜€

A revoir : 
  - ajouter l'installation de `cross-env` dans le Dockerfile

- **front** : dÃ©ploiement de la branche en preprod
  - `git clone xxx front`
  - `cd front`
  - `git fetch origin`
  - `git checkout PF-119`
  - copie du fichier `.env` Ã  la racine du projet
  - `docker compose build`
  - `docker compose up -d`
  - Le front est accessible sur le port 8083 ðŸ˜€

A revoir :
    - problÃ¨me avec les node_modules

> Penser Ã  ajouter la conf `volumes` dans le `docker-compose.yml` pour persister les donnÃ©es

> Ajouter les variables d'environnement dans le `.env` du projet puis dans le Dockerfile